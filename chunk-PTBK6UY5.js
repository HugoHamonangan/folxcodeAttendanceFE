import{a as ce}from"./chunk-UIAZJ55A.js";import{a as Q}from"./chunk-LSM4Q6XX.js";import{a as R}from"./chunk-Z4CE53GY.js";import{a as ee,b as te,c as ie,d as re,e as oe,f as ne,g as ae,h as se}from"./chunk-BYGHQCG7.js";import{a as le,b as de,c as pe}from"./chunk-MLGKG3GN.js";import{h as X,i as Y,j as Z}from"./chunk-ZYGI2F2J.js";import"./chunk-5HKWY6RO.js";import"./chunk-DTTFVCDB.js";import{$a as K,Aa as W,Sa as J,n as O,ta as q,wa as H}from"./chunk-ZAHCPB2U.js";import{$ as _,$b as I,Ab as b,Cb as C,Cc as N,Db as k,E as T,Eb as a,Ec as j,Fb as l,Gb as u,H as F,Kb as y,Mb as v,Nb as m,S as U,Sc as z,Wb as S,Xa as s,Xb as f,Yb as w,Zb as B,ac as $,bc as A,fc as M,ga as c,ha as p,hb as V,hc as P,ic as G,mb as h,p as L,ub as g,w as E,wa as x,zb as D}from"./chunk-24CHYTPN.js";import"./chunk-TSRGIXR5.js";var ge=(r,t)=>({"border-blue-500":r,"border-tertiary-300 dark:border-gray-800":t}),ve=r=>({"bg-information-600! hover:bg-information-800! text-white!":r});function fe(r,t){if(r&1){let e=y();a(0,"button",18),v("click",function(i){c(e);let n=m().$implicit;m();let d=S(3);return n==null||n.action(i),p(d.hide())}),u(1,"fc-icon",19),a(2,"span",20),f(3),l()()}if(r&2){let e=m().$implicit;s(),g("icon",e.icon),s(2),w(e.name)}}function _e(r,t){if(r&1&&h(0,fe,4,2,"button",17),r&2){let e=t.$implicit;D(e.hide===!1?0:-1)}}function xe(r,t){if(r&1){let e=y();a(0,"button",22),v("click",function(i){c(e);let n=m().$implicit;return p(n==null?null:n.action(i))}),u(1,"fc-icon",19),a(2,"span",20),f(3),l()()}if(r&2){let e=m().$implicit;g("ngClass",P(3,ve,e.name==="New User")),s(),g("icon",e.icon),s(2),w(e.name)}}function ye(r,t){if(r&1&&h(0,xe,4,5,"button",21),r&2){let e=t.$implicit;D(e.hide===!1?0:-1)}}function he(r,t){r&1&&u(0,"div",26)}function De(r,t){r&1&&(a(0,"div",27),u(1,"img",29),a(2,"span",30),f(3,"Data Not Found"),l()())}function be(r,t){r&1&&u(0,"div",41)}function Ce(r,t){if(r&1){let e=y();a(0,"div",31),v("cdkDragStarted",function(i){let n=c(e).$implicit,d=m(2);return p(d.onDragStarted(i,n))})("cdkDragEnded",function(){c(e);let i=m(2);return p(i.onDragEnded())}),h(1,be,1,0,"div",32),a(2,"div",33),v("click",function(i){let n=c(e).$implicit;return m(2).onNavigateToUser(n),p(i.preventDefault())}),a(3,"button",34),v("click",function(i){return c(e),p(i.stopPropagation())}),u(4,"fc-icon",35),l(),a(5,"div",36),u(6,"img",37),a(7,"div",38)(8,"span",39),f(9),l(),a(10,"span",40),f(11),l()()()()()}if(r&2){let e=t.$implicit;s(4),g("icon","drag"),s(5),w(e.name),s(2),w(e.email)}}function ke(r,t){if(r&1){let e=y();a(0,"div",16),u(1,"div",23),a(2,"span",24),f(3),l(),a(4,"div",25),v("cdkDropListDropped",function(i){let n=c(e).$implicit,d=m();return p(d.onDrop(i,n))})("cdkDropListEntered",function(i){c(e);let n=m();return p(n.onEntered(i))})("cdkDropListExited",function(i){c(e);let n=m();return p(n.onExited(i))}),h(5,he,1,0,"div",26)(6,De,4,0,"div",27),C(7,Ce,12,3,"div",28,b),l()()}if(r&2){let e,o=t.$implicit,i=m();s(3),B(" ",o.name," "),s(),g("cdkDropListData",i.divisionCategoryGrouping[o.name]),s(),D(i.isLoading===!0?5:-1),s(),D(((e=i.divisionCategoryGrouping[o.name]==null?null:i.divisionCategoryGrouping[o.name].length)!==null&&e!==void 0?e:0)===0&&i.isEmptyData===!0&&i.isLoading===!1?6:-1),s(),k(i.divisionCategoryGrouping[o.name])}}var me=class r{title="test";fcConfirmService=_(Q);divisionService=_(ce);toastService=_(R);userService=_(pe);router=_(O);isItemEnteredList=x(!1);isSearchFocus=x(!1);divisionLists=x([]);draggedUser=x(null);search=x("");isLoading=!0;reqeustDelay=311;debounceSearch=de(le(this.search).pipe(T(this.reqeustDelay),F()),{initialValue:""});options={path:"/lotties/loading.json",loop:!0,autoplay:!0};actionButtons=[];resource=j({request:()=>({}),loader:({})=>{let t=new URLSearchParams({}).toString();return L(this.divisionService.getDivisions(t).pipe(U(e=>this.divisionLists.set(e.divisions))))}});constructor(){this.initializeActionButtons(),N(()=>{this.initializeDivisionCategoryGrouping()})}divisionCategoryGrouping={};initializeDivisionCategoryGrouping(){this.isLoading=!0;let t=this.divisionLists().map(e=>this.userService.getUsers(`limit=9999&division_id=${e.id}&q=${this.debounceSearch()}`));this.divisionCategoryGrouping={},E(t).subscribe(e=>{this.divisionLists().forEach((o,i)=>{this.divisionCategoryGrouping[o.name]=e[i].users,console.log(e[i])}),this.isLoading=!1})}initializeActionButtons(){this.actionButtons=[]}onDrop(t,e){t.previousContainer!==t.container&&this.fcConfirmService.open({message:`Are you sure you want to move ${this.draggedUser().name} to ${e.name}?`,accept:()=>{this.moveUserToTargetDivision(t,e)}})}moveUserToTargetDivision(t,e){let o=[];if(Array.isArray(this.draggedUser().roles))for(let n=0;n<this.draggedUser().roles.length;n++)o.push({role_id:this.draggedUser().roles[n].id});let i={name:this.draggedUser().name,username:this.draggedUser().username,email:this.draggedUser().email,address:this.draggedUser().address,phone:this.draggedUser().phone,division_id:e.id,roles:o};this.userService.updateUser(this.draggedUser().id,i).subscribe({next:n=>{let d=`Succesfully Update ${n.data.user.name} to ${e.name}`;this.toastService.clearToast(),this.handleDivisionUserDrop(t),this.toastService.displayToast({summary:d},"success")},error:n=>{console.error("Error:",n),this.toastService.clearToast(),this.toastService.displayToast({summary:"something went wrong"},"fail")}})}handleDivisionUserDrop(t){t.previousContainer===t.container?ee(t.container.data,t.previousIndex,t.currentIndex):te(t.previousContainer.data,t.container.data,t.previousIndex,t.currentIndex)}isEmptyData=!0;onEntered(t){t.container.data.length>0?this.isEmptyData=!0:this.isEmptyData=!1}onExited(t){}onDragStarted(t,e){this.draggedUser.set(e)}onDragEnded(){}onNavigateToUser(t){this.router.navigate([`users/view/${t.id}`])}static \u0275fac=function(e){return new(e||r)};static \u0275cmp=V({type:r,selectors:[["division-list"]],features:[M([Y])],decls:22,vars:7,consts:[["actionButtonPopover",""],["searchInput",""],[1,"animateDiv","flex","h-full","flex-col","gap-4"],[1,"xs:flex-row","flex","flex-col-reverse","justify-between","gap-6"],[1,"absolute"],[1,"flex","w-fit","min-w-40","flex-col","gap-2"],[1,"xs:w-fit","xs:flex-row","xs:h-[1.8rem]","ml-auto","flex","h-[2.3rem]","w-full","flex-row-reverse","gap-1.5"],[1,"grid","w-10.5","place-items-center","rounded-md","bg-gray-100","lg:hidden","dark:bg-gray-800",3,"click"],[1,"text-xl","dark:text-white!",3,"icon"],[1,"hidden","h-full","items-center","gap-1","lg:flex"],[1,"xs:max-w-60","relative","flex","h-full","w-full","items-center","gap-2","rounded-lg","border","bg-white","pl-3","duration-100","dark:bg-gray-800",3,"ngClass"],[1,"grid","place-items-center","rounded-md"],[1,"text-sm","text-gray-600","dark:text-gray-400",3,"icon"],["type","text","placeholder","Search",1,"placeholder-tertiary-400","w-full","items-center","bg-transparent","py-1.5","pr-10","text-xs","text-gray-900","duration-100","focus:border-transparent","focus:outline-none","dark:text-gray-100","dark:placeholder-gray-400",3,"ngModelChange","focus","blur","ngModel"],[1,"h-full","w-full","overflow-x-auto","py-2"],["cdkDropListGroup","",1,"flex","h-full","items-center","gap-4"],[1,"bg-tertiary-50","border-tertiary-300","relative","flex","h-full","w-full","min-w-[18rem]","flex-col","items-center","gap-4","rounded-xl","border","p-2","dark:border-gray-600","dark:bg-gray-800"],[1,"hover:bg-tertiary-200","bg-tertiary-100","relative","flex","h-[2rem]","items-center","gap-1.5","rounded-md","px-2","py-0","text-xs","text-gray-900","duration-100","active:scale-95","dark:border-gray-800","dark:bg-gray-800","dark:text-gray-100","dark:hover:bg-gray-700"],[1,"hover:bg-tertiary-200","bg-tertiary-100","relative","flex","h-[2rem]","items-center","gap-1.5","rounded-md","px-2","py-0","text-xs","text-gray-900","duration-100","active:scale-95","dark:border-gray-800","dark:bg-gray-800","dark:text-gray-100","dark:hover:bg-gray-700",3,"click"],[1,"-translate-y-[0.066rem]","text-xs",3,"icon"],[1,"text-nowrap"],[1,"hover:bg-tertiary-200","bg-tertiary-100","relative","flex","h-full","items-center","gap-1.5","rounded-md","px-2","py-0","text-xs","text-gray-900","duration-100","active:scale-95","dark:border-gray-800","dark:bg-gray-800","dark:text-gray-100","dark:hover:bg-gray-700",3,"ngClass"],[1,"hover:bg-tertiary-200","bg-tertiary-100","relative","flex","h-full","items-center","gap-1.5","rounded-md","px-2","py-0","text-xs","text-gray-900","duration-100","active:scale-95","dark:border-gray-800","dark:bg-gray-800","dark:text-gray-100","dark:hover:bg-gray-700",3,"click","ngClass"],[1,"bg-primary","absolute","top-0","left-1/2","h-[0.5rem]","w-[8rem]","-translate-1/2","rounded-full","dark:bg-blue-600"],[1,"text-primary","mt-3","text-xl","font-semibold","capitalize","dark:text-white"],["cdkDropList","",1,"relative","flex","h-full","w-full","flex-col","items-center","gap-2","overflow-x-hidden","overflow-y-auto","p-2",3,"cdkDropListDropped","cdkDropListEntered","cdkDropListExited","cdkDropListData"],[1,"secondary-loader","absolute","top-1/2","left-1/2","-translate-x-1/2","-translate-y-1/2"],[1,"flex","h-full","w-full","flex-col","items-center","justify-center","gap-2"],["cdkDrag","",1,"w-full","bg-none"],["src","images/backgrounds/file-not-found.svg","alt","file not found image",1,"w-[11rem]","object-cover"],[1,"text-lg","font-medium","dark:text-gray-300"],["cdkDrag","",1,"w-full","bg-none",3,"cdkDragStarted","cdkDragEnded"],["class","bg-tertiary-300 border-tertiary-500 h-[4.2rem] w-full rounded-xl border-2 border-dashed dark:border-gray-700 dark:bg-gray-600",4,"cdkDragPlaceholder"],[1,"border-tertiary-200","bg-primary","group","relative","z-50","flex","w-full","cursor-pointer","items-center","gap-1","rounded-xl","border","px-2","py-3","text-white","hover:bg-[#0a0c0d]","active:shadow-xl","dark:border-gray-600",3,"click"],["cdkDragHandle","",1,"invisible","grid","!cursor-move","place-items-center","py-2","opacity-0","group-hover:visible","group-hover:opacity-100",3,"click"],[1,"text-2xl","text-white",3,"icon"],[1,"-m-6","flex","items-center","gap-2","duration-200","group-hover:m-0"],["src","images/placeholders/placeholder-user.jpg","alt","placeholder",1,"size-[2.5rem]","rounded-md","object-cover"],[1,"flex","flex-col","gap-0"],[1,"font-semibold","text-white"],[1,"w-full","truncate","text-xs","text-gray-300"],[1,"bg-tertiary-300","border-tertiary-500","h-[4.2rem]","w-full","rounded-xl","border-2","border-dashed","dark:border-gray-700","dark:bg-gray-600"]],template:function(e,o){if(e&1){let i=y();a(0,"div",2)(1,"div",3)(2,"p-popover",4,0)(4,"div",5),C(5,_e,1,1,null,null,b),l()(),a(7,"div",6)(8,"button",7),v("click",function(d){c(i);let ue=S(3);return p(ue.toggle(d))}),u(9,"fc-icon",8),l(),a(10,"div",9),C(11,ye,1,1,null,null,b),l(),a(13,"div",10)(14,"div",11),u(15,"fc-icon",12),l(),a(16,"input",13,1),A("ngModelChange",function(d){return c(i),$(o.search,d)||(o.search=d),p(d)}),v("focus",function(){return c(i),p(o.isSearchFocus.set(!0))})("blur",function(){return c(i),p(o.isSearchFocus.set(!1))}),l()()()(),a(18,"div",14)(19,"div",15),C(20,ke,9,4,"div",16,b),l()()()}e&2&&(s(5),k(o.actionButtons),s(4),g("icon","ellipsisVertical"),s(2),k(o.actionButtons),s(2),g("ngClass",G(4,ge,o.isSearchFocus(),!o.isSearchFocus())),s(2),g("icon","search"),s(),I("ngModel",o.search),s(4),k(o.divisionLists()))},dependencies:[K,q,H,W,z,J,X,re,se,ne,oe,ie,ae,Z],encapsulation:2})};export{me as DivisionListComponent};
