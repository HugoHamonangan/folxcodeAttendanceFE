import{b as Pe}from"./chunk-B3OUCL7Z.js";import{a as be}from"./chunk-KRSGJYAG.js";import{a as ae}from"./chunk-LUSJALC7.js";import{a as Se}from"./chunk-Q4GO5ARB.js";import{f as Ue}from"./chunk-NFZ6GDEL.js";import{a as ke}from"./chunk-SYBY7P64.js";import{a as se}from"./chunk-Z4CE53GY.js";import{a as Ce,b as we,c as D}from"./chunk-Y2PXB5NQ.js";import{g as ye,h as _e,i as $,j as xe}from"./chunk-ZYGI2F2J.js";import"./chunk-JEWDWJGV.js";import"./chunk-DTTFVCDB.js";import{$a as I,Aa as ce,Ba as ue,Ca as pe,Da as fe,Ea as ge,Oa as he,Sa as A,Ua as ve,l as ne,n as oe,ta as le,ua as g,wa as L,xa as de,ya as me,za as v}from"./chunk-ZAHCPB2U.js";import{$ as c,$b as Y,Ab as N,Cb as E,Cc as U,Db as M,E as H,Eb as a,Ec as P,Fb as l,Gb as u,H as j,Hb as O,Ib as W,Kb as T,Mb as h,Nb as p,R as G,Sc as te,Vc as ie,Wb as V,Wc as re,Xa as n,Xb as f,Yb as S,Zb as k,ac as Z,bc as J,fc as K,ga as y,ha as _,hb as F,hc as R,ic as Q,mb as b,p as w,qc as X,ub as s,uc as ee,wa as x,zb as C}from"./chunk-24CHYTPN.js";import{a as z,b as B}from"./chunk-TSRGIXR5.js";function Be(i,t){i&1&&u(0,"span",21)}var q=class i{ref=c(ye);userService=c(D);divisionService=c(ke);userAddForm;isLoading=!1;divisions=P({request:()=>({}),loader:({})=>{let t=new URLSearchParams({}).toString();return w(this.divisionService.getDivisions(t))}});constructor(){this.initializeUserAddForm(),U(()=>{console.log(this.divisions.value())})}initializeUserAddForm(){this.userAddForm=new me({fullname:new v("",g.required),email:new v("",[g.required,g.email]),username:new v("",g.required),phone:new v("",[g.required,g.minLength(10)]),password:new v("",[g.required,g.minLength(7)]),address:new v("",g.required),role:new v("",g.required),division:new v("",g.required)})}roles=P({loader:()=>w(this.userService.getRoles())});close(t){this.ref?.close(t)}submit(){if(this.userAddForm.invalid){this.userAddForm.markAllAsTouched();return}this.isLoading=!0;let t=this.userAddForm.value.role,e=[];if(Array.isArray(t))for(let o=0;o<t.length;o++)e.push({role_id:t[o].id});else t&&e.push({role_id:t.id});let r={name:this.userAddForm.value.fullname,username:this.userAddForm.value.username,email:this.userAddForm.value.email,address:this.userAddForm.value.address,password:this.userAddForm.value.password,phone:this.userAddForm.value.phone,division_id:this.userAddForm.value.division.id,roles:e};this.close(r)}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["user-add"]],decls:24,vars:57,consts:[[1,"flex","max-h-[80vh]","flex-col","md:max-h-max",3,"ngSubmit","formGroup"],[1,"border-tertiary-300","sticky","top-0","z-10","flex","items-center","justify-between","rounded-t-xl","border-b-1","bg-white","px-5","py-4","dark:border-gray-700","dark:bg-gray-900"],[1,"flex","items-center","gap-3"],[1,"text-4xl","!text-white",3,"icon"],[1,"text-lg","font-bold","text-gray-900","dark:text-gray-100"],[1,"hover:bg-tertiary-100","grid","size-8","place-items-center","rounded-md","active:scale-90","dark:hover:bg-gray-800",3,"click","keydown.enter"],[1,"text-lg","text-gray-800","dark:text-gray-300",3,"icon"],[1,"flex","h-full","flex-col","gap-4","overflow-y-auto","p-5","md:overflow-visible"],[1,"grid","grid-cols-1","gap-4","md:grid-cols-2"],["formControlName","fullname",3,"size","placeholder","id","title","type","required"],["formControlName","email",3,"size","placeholder","id","title","type","required"],["formControlName","username",3,"size","placeholder","id","title","required","type"],["formControlName","phone",3,"size","placeholder","id","title","type","required"],["formControlName","role",1,"z-50",3,"datas","size","placeholder","id","title","required","isMultipleMode"],["formControlName","division",1,"z-50",3,"datas","size","placeholder","id","title","required","isMultipleMode"],["formControlName","password",3,"size","placeholder","id","title","required","type"],["formControlName","address",3,"size","placeholder","id","title","type","required"],[1,"sticky","bottom-0","w-full","rounded-b-xl","bg-white","dark:bg-gray-900"],["type","submit",1,"hover:bg-information-700","bg-information-600","z-10","m-5","ml-auto","flex","w-fit","items-center","gap-1.5","rounded-md","p-3","text-sm","text-white","duration-100","active:scale-95","disabled:scale-100","disabled:cursor-not-allowed","disabled:bg-gray-500",3,"keydown.enter","pTooltip","disabled"],[1,"text-sm","text-white",3,"icon"],["class","loader",4,"ngIf"],[1,"loader"]],template:function(e,r){if(e&1&&(a(0,"form",0),h("ngSubmit",function(){return r.submit()}),a(1,"div",1)(2,"div",2),u(3,"fc-icon",3),a(4,"span",4),f(5," Create New User Form "),l()(),a(6,"button",5),h("click",function(){return r.close()})("keydown.enter",function(){return r.close()}),u(7,"fc-icon",6),l()(),a(8,"div",7)(9,"div",8),u(10,"fc-input-text",9)(11,"fc-input-text",10)(12,"fc-input-text",11)(13,"fc-input-text",12)(14,"fc-select",13)(15,"fc-select",14)(16,"fc-input-text",15)(17,"fc-input-text",16),l()(),a(18,"div",17)(19,"button",18),h("keydown.enter",function(){return r.submit()}),u(20,"fc-icon",19),a(21,"span"),f(22,"Submit Form"),l(),b(23,Be,1,0,"span",20),l()()()),e&2){let o;s("formGroup",r.userAddForm),n(3),s("icon","userElegant"),n(4),s("icon","x"),n(3),s("size","normal")("placeholder","Please Input Full Name")("id","fullname")("title","Full Name")("type","text")("required",!0),n(),s("size","normal")("placeholder","Please Input Email")("id","email")("title","Email")("type","email")("required",!0),n(),s("size","normal")("placeholder","Please Input Username")("id","username")("title","Username")("required",!0)("type","text"),n(),s("size","normal")("placeholder","Please Input Phone Number")("id","phone")("title","Phone")("type","number")("required",!0),n(),s("datas",r.roles.value())("size","normal")("placeholder","Please Input Role")("id","role")("title","User Role")("required",!0)("isMultipleMode",!1),n(),s("datas",(o=r.divisions.value())==null?null:o.divisions)("size","normal")("placeholder","Please Input Division")("id","division")("title","User Division")("required",!0)("isMultipleMode",!1),n(),s("size","normal")("placeholder","Please Input Password")("id","password")("title","Password")("required",!0)("type","password"),n(),s("size","normal")("placeholder","Please Input Address")("id","address")("title","Address")("type","text")("required",!0),n(2),s("pTooltip",r.userAddForm.invalid?"Fill the form correctly":"Submit Form")("disabled",r.userAddForm.invalid),n(),s("icon","plus"),n(3),s("ngIf",r.isLoading===!0)}},dependencies:[I,ue,L,de,ge,pe,fe,ie,A,he,be,Pe],encapsulation:2})};var Ne=(i,t)=>({"border-blue-500":i,"border-tertiary-300 dark:border-gray-800":t}),Te=i=>({"bg-information-600! hover:bg-information-800! text-white!":i});function Ee(i,t){if(i&1){let e=T();a(0,"button",17),h("click",function(o){y(e);let d=p().$implicit;p();let m=V(3);return d==null||d.action(o),_(m.hide())}),u(1,"fc-icon",18),a(2,"span",19),f(3),l()()}if(i&2){let e=p().$implicit;s("ngClass",R(3,Te,e.name==="New User")),n(),s("icon",e.icon),n(2),S(e.name)}}function Me(i,t){if(i&1&&b(0,Ee,4,5,"button",16),i&2){let e=t.$implicit;C(e.hide===!1?0:-1)}}function Ve(i,t){if(i&1){let e=T();a(0,"button",21),h("click",function(o){y(e);let d=p().$implicit;return _(d==null?null:d.action(o))}),u(1,"fc-icon",22),a(2,"span",19),f(3),l()()}if(i&2){let e=p().$implicit;s("ngClass",R(3,Te,e.name==="New User")),n(),s("icon",e.icon),n(2),S(e.name)}}function Re(i,t){if(i&1&&b(0,Ve,4,5,"button",20),i&2){let e=t.$implicit;C(e.hide===!1?0:-1)}}function $e(i,t){if(i&1&&f(0),i&2){let e=p().rowIndex,r=p();k(" ",e+1+(r.pagination.currentPage-1)*20," ")}}function He(i,t){if(i&1&&(a(0,"div",24),u(1,"div",25),a(2,"span",26),f(3),l()()),i&2){let e=p().value;n(3),S(e.name)}}function je(i,t){if(i&1&&(a(0,"div",24),u(1,"div",27),a(2,"span",26),f(3),l()()),i&2){let e=p().value;n(3),S(e.name)}}function Ge(i,t){if(i&1&&(a(0,"div",28)(1,"span",30),f(2),l(),a(3,"span",31),f(4),l()()),i&2){let e=p(2).value;n(2),k(" ",e.name.name," "),n(2),k(" ",e.name.username," ")}}function Oe(i,t){if(i&1&&(a(0,"div",29)(1,"span",30),f(2),l()()),i&2){let e=p(2).value;n(2),k(" ",e.name," ")}}function We(i,t){if(i&1&&b(0,Ge,5,2,"div",28)(1,Oe,3,1,"div",29),i&2){let e=p().col;C(e.key==="user"?0:-1),n(),C(e.key==="email"||e.key==="division"||e.key==="role"?1:-1)}}function Ye(i,t){if(i&1&&(O(0,23),b(1,$e,1,1)(2,He,4,1,"div",24)(3,je,4,1,"div",24)(4,We,2,2),W()),i&2){let e=t.col,r=t.value;s("ngSwitch",e.key),n(),C(r!=null&&r.name?r.name==="active"?2:r.name==="inactive"?3:4:1)}}var Fe=class i{dialogRefService=c(ae);LayoutService=c(Ue);dialogService=c($);toastService=c(se);userService=c(D);router=c(oe);route=c(ne);cdr=c(ee);previousUserPage=x(null);currentUserPage=x(1);isSearchFocus=x(!1);currentRoute=x("");usersList=x([]);bodies=x([]);search=x("");actionButtons=[];countSnapshot;pagination;headers=[];ref;reqeustDelay=311;debounceSearch=we(Ce(this.search).pipe(H(this.reqeustDelay),j()),{initialValue:""});users=P({request:()=>({page:this.currentUserPage(),q:this.debounceSearch()}),loader:({request:t,abortSignal:e})=>{let r=new URLSearchParams({limit:"20",q:String(t.q),page:String(t.page)}).toString(),o=Se(e);return w(this.userService.getUsers(r).pipe(G(o)))}});constructor(){this.initializeActionButtons(),this.initializeHeaders(),this.subscribePreviousCurrentPage(),this.initializeEffect(),this.LayoutService.currentPageName.set("User List")}subscribePreviousCurrentPage(){this.route.queryParamMap.subscribe(t=>{let e=+(t.get("page")||1);this.currentUserPage()!==e&&(this.previousUserPage.set(this.currentUserPage()),this.currentUserPage.set(e))})}initializeEffect(){U(()=>{this.router.navigate([],{relativeTo:this.route,queryParams:{page:this.currentUserPage()},queryParamsHandling:"merge"})}),U(()=>{let t=this.users.value();t&&this.updateTableData(t)})}initializeActionButtons(){this.actionButtons=[{name:"New User",icon:"plus",hide:!1,action:()=>this.showAddUserDialog()}]}initializeHeaders(){this.headers=[{name:"#",key:"",hideable:!1},{name:"Id",key:"id",hide:!0},{name:"User",key:"user",hideable:!1},{name:"Email",key:"email",hideable:!1},{name:"Division",key:"division",hideable:!0},{name:"Role",key:"role",hideable:!0},{name:"Status",key:"status",hideable:!1}]}updateTableData(t){this.usersList.set(t.users);let e=this.mapUsersToBodies(t.users);this.bodies.set(e),this.cdr.markForCheck(),this.pagination={nextPage:()=>this.nextPage(),prevPage:()=>this.prevPage(),currentPage:t.currentPage,totalPage:t.totalPages},this.countSnapshot=t.count}mapUsersToBodies(t){return t.map(e=>({id:{name:e.id,hide:!0},user:{name:{name:e.name,username:e.username},hideable:!1},email:{name:e.email,hideable:!0},division:{name:e.division?.name??"No Division Yet",hideable:!0},role:{name:e.roles.length>1?`${e.roles[0]?.name} +${e.roles.length-1}`:`${e.roles[0]?.name==null?"-":e.roles[0]?.name}`,hideable:!0},status:{name:e.status,hideable:!1},isDone:{name:e.id.toString()!=="temporaryId",hideable:!0}}))}nextPage(){this.currentUserPage.update(t=>t<this.users.value().totalPages?t+1:t)}prevPage(){this.currentUserPage.update(t=>Math.max(1,t-1))}showAddUserDialog(){this.ref=this.dialogService.open(q,{width:"50rem",baseZIndex:1e4,modal:!0,dismissableMask:!0,focusOnShow:!0,showHeader:!1,styleClass:"!p-0 m-4",contentStyle:{overflow:"visible"},closeOnEscape:!0,transitionOptions:"0ms cubic-bezier(0, 0, 0.2, 1)"}),this.dialogRefService.dialogRef=this.ref,this.ref.onClose.subscribe(t=>{if(t){if(this.usersList().length<20){let r=B(z({},t),{id:t.id??"temporaryId"});this.usersList.update(d=>[...d,r]);let o=this.mapUsersToBodies(this.usersList());this.bodies.set(o),this.toastService.displayToast({summary:`Successfully added ${t.name}`,life:2e3},"success"),this.countSnapshot&&(this.countSnapshot+=1)}this.userService.addUser(t).subscribe({next:e=>{let r=e.data.user.id;this.usersList.update(d=>d.map(m=>m.id==="temporaryId"?B(z({},m),{id:r}):m));let o=this.mapUsersToBodies(this.usersList());this.bodies.set(o),this.usersList().length===20&&this.users.reload()}})}})}onRowClick(t){console.log("Row clicked:",t),this.router.navigate([`users/view/${t.id.name}`])}static \u0275fac=function(e){return new(e||i)};static \u0275cmp=F({type:i,selectors:[["user-list"]],features:[K([$])],decls:21,vars:12,consts:[["actionButtonPopover",""],["searchInput",""],["cellTemplate",""],[1,"animateDiv","flex","h-full","flex-col","gap-4","rounded-xl"],[1,"xs:flex-row","flex","flex-col-reverse","justify-between","gap-6"],[1,"absolute"],[1,"flex","w-fit","min-w-40","flex-col","gap-2"],[1,"xs:w-fit","xs:flex-row","xs:h-[1.8rem]","ml-auto","flex","h-[2.3rem]","w-full","flex-row-reverse","gap-1.5"],[1,"grid","w-10.5","place-items-center","rounded-md","bg-gray-100","lg:hidden","dark:bg-gray-800",3,"click"],[1,"text-xl","dark:text-white!",3,"icon"],[1,"hidden","h-full","items-center","gap-1","lg:flex"],[1,"xs:max-w-60","relative","flex","h-full","w-full","items-center","gap-2","rounded-lg","border","bg-white","pl-3","dark:bg-gray-800",3,"ngClass"],[1,"grid","place-items-center","rounded-md"],[1,"text-sm","text-gray-600","dark:text-gray-400",3,"icon"],["type","text","placeholder","Search",1,"placeholder-tertiary-400","w-full","items-center","bg-transparent","py-1.5","pr-10","text-xs","text-gray-900","duration-100","focus:border-transparent","focus:outline-none","dark:text-gray-100","dark:placeholder-gray-400",3,"ngModelChange","focus","blur","ngModel"],[1,"h-full","min-h-0",3,"clickedRow","headers","bodies","isLoading","pagination","totalData"],[1,"hover:bg-tertiary-200","bg-tertiary-100","relative","flex","h-[2rem]","items-center","gap-1.5","rounded-md","px-2","py-0","text-xs","text-gray-900","duration-100","active:scale-95","dark:border-gray-800","dark:bg-gray-800","dark:text-gray-100","dark:hover:bg-gray-700",3,"ngClass"],[1,"hover:bg-tertiary-200","bg-tertiary-100","relative","flex","h-[2rem]","items-center","gap-1.5","rounded-md","px-2","py-0","text-xs","text-gray-900","duration-100","active:scale-95","dark:border-gray-800","dark:bg-gray-800","dark:text-gray-100","dark:hover:bg-gray-700",3,"click","ngClass"],[1,"text-xs",3,"icon"],[1,"text-nowrap"],[1,"hover:bg-tertiary-200","bg-tertiary-100","relative","flex","h-full","items-center","gap-1.5","rounded-md","px-2","py-0","text-xs","text-gray-900","duration-100","active:scale-95","dark:border-gray-800","dark:bg-gray-800","dark:text-gray-100","dark:hover:bg-gray-700",3,"ngClass"],[1,"hover:bg-tertiary-200","bg-tertiary-100","relative","flex","h-full","items-center","gap-1.5","rounded-md","px-2","py-0","text-xs","text-gray-900","duration-100","active:scale-95","dark:border-gray-800","dark:bg-gray-800","dark:text-gray-100","dark:hover:bg-gray-700",3,"click","ngClass"],[1,"-translate-y-[0.066rem]","text-xs",3,"icon"],[3,"ngSwitch"],[1,"flex","w-full","items-center","justify-end","gap-2","@2xl:justify-start"],[1,"size-2.5","rounded-full","bg-green-500","shadow-[0_0_5px_rgba(34,197,94,0.5)]"],[1,"text-gray-900","capitalize","dark:text-gray-200"],[1,"size-2.5","rounded-full","bg-red-500","shadow-[0_0_5px_rgba(239,68,68,0.5)]"],[1,"flex","w-full","flex-col"],[1,"flex","flex-col"],[1,"font-medium","text-gray-900","dark:text-gray-200"],[1,"text-left","text-xs","text-gray-400","dark:text-gray-400"]],template:function(e,r){if(e&1){let o=T();a(0,"div",3)(1,"div",4)(2,"p-popover",5,0)(4,"div",6),E(5,Me,1,1,null,null,N),l()(),a(7,"div",7)(8,"button",8),h("click",function(m){y(o);let Le=V(3);return _(Le.toggle(m))}),u(9,"fc-icon",9),l(),a(10,"div",10),E(11,Re,1,1,null,null,N),l(),a(13,"div",11)(14,"div",12),u(15,"fc-icon",13),l(),a(16,"input",14,1),J("ngModelChange",function(m){return y(o),Z(r.search,m)||(r.search=m),_(m)}),h("focus",function(){return y(o),_(r.isSearchFocus.set(!0))})("blur",function(){return y(o),_(r.isSearchFocus.set(!1))}),l()()()(),a(18,"fc-table",15),h("clickedRow",function(m){return y(o),_(r.onRowClick(m))}),b(19,Ye,5,2,"ng-template",null,2,X),l()()}e&2&&(n(5),M(r.actionButtons),n(4),s("icon","ellipsisVertical"),n(2),M(r.actionButtons),n(2),s("ngClass",Q(9,Ne,r.isSearchFocus(),!r.isSearchFocus())),n(2),s("icon","search"),n(),Y("ngModel",r.search),n(2),s("headers",r.headers)("bodies",r.bodies())("isLoading",r.users.isLoading())("pagination",r.pagination)("totalData",r.countSnapshot))},dependencies:[I,le,L,ce,te,re,A,ve,_e,xe],styles:[".user-view-dialog-height[_ngcontent-%COMP%]{height:100%}@media (max-width: 1024px){.user-view-dialog-height[_ngcontent-%COMP%]{height:auto}}"]})};export{Fe as UserListComponent};
