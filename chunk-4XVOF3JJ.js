import{b as Te,n as Se}from"./chunk-ZAHCPB2U.js";import{$ as Oe,Aa as Ae,V as j,_ as h,cd as x,q as xe,wa as u}from"./chunk-24CHYTPN.js";var O=class{constructor(e,r){this.operator=e,this.value=r,Object.defineProperty(this,"t",{writable:!0})}get notes(){return this.t}addNote(e){this.t=this.t||[],this.t.push(e)}},y=class extends O{},d=class extends y{constructor(e,r){if(!Array.isArray(r))throw new Error(`"${e}" operator expects to receive an array of conditions`);super(e,r)}},p="__itself__",f=class extends O{constructor(e,r,s){super(e,s),this.field=r}},Q=new y("__null__",null),z=Object.prototype.hasOwnProperty.call.bind(Object.prototype.hasOwnProperty);function Ke(t,e){return e instanceof d&&e.operator===t}function J(t,e){return e.length===1?e[0]:new d(t,function r(s,n,i){let o=i||[];for(let a=0,c=n.length;a<c;a++){let l=n[a];Ke(s,l)?r(s,l.value,o):o.push(l)}return o}(t,e))}var Ze=t=>t,Me=()=>Object.create(null),Ie=Object.defineProperty(Me(),"__@type@__",{value:"ignore value"});function et(t,e,r=!1){if(!t||t&&t.constructor!==Object)return!1;for(let s in t)if(z(t,s)&&z(e,s)&&(!r||t[s]!==Ie))return!0;return!1}function tt(t){let e=[];for(let r in t)z(t,r)&&t[r]!==Ie&&e.push(r);return e}function L(t,e){e!==Q&&t.push(e)}var V=t=>J("and",t);var A={compound(t,e,r){let s=(Array.isArray(e)?e:[e]).map(n=>r.parse(n));return new d(t.name,s)},field:(t,e,r)=>new f(t.name,r.field,e),document:(t,e)=>new y(t.name,e)},b=class{constructor(e,r=Me()){this.o=void 0,this.s=void 0,this.i=void 0,this.u=void 0,this.h=void 0,this.parse=this.parse.bind(this),this.u={operatorToConditionName:r.operatorToConditionName||Ze,defaultOperatorName:r.defaultOperatorName||"eq",mergeFinalConditions:r.mergeFinalConditions||V},this.o=Object.keys(e).reduce((s,n)=>(s[n]=Object.assign({name:this.u.operatorToConditionName(n)},e[n]),s),{}),this.s=Object.assign({},r.fieldContext,{field:"",query:{},parse:this.parse,hasOperators:s=>et(s,this.o,r.useIgnoreValue)}),this.i=Object.assign({},r.documentContext,{parse:this.parse,query:{}}),this.h=r.useIgnoreValue?tt:Object.keys}setParse(e){this.parse=e,this.s.parse=e,this.i.parse=e}parseField(e,r,s,n){let i=this.o[r];if(!i)throw new Error(`Unsupported operator "${r}"`);if(i.type!=="field")throw new Error(`Unexpected ${i.type} operator "${r}" at field level`);return this.s.field=e,this.s.query=n,this.parseInstruction(i,s,this.s)}parseInstruction(e,r,s){return typeof e.validate=="function"&&e.validate(e,r),(e.parse||A[e.type])(e,r,s)}parseFieldOperators(e,r){let s=[],n=this.h(r);for(let i=0,o=n.length;i<o;i++){let a=n[i];if(!this.o[a])throw new Error(`Field query for "${e}" may contain only operators or a plain object as a value`);L(s,this.parseField(e,a,r[a],r))}return s}parse(e){let r=[],s=this.h(e);this.i.query=e;for(let n=0,i=s.length;n<i;n++){let o=s[n],a=e[o],c=this.o[o];if(c){if(c.type!=="document"&&c.type!=="compound")throw new Error(`Cannot use parsing instruction for operator "${o}" in "document" context as it is supposed to be used in  "${c.type}" context`);L(r,this.parseInstruction(c,a,this.i))}else this.s.hasOperators(a)?r.push(...this.parseFieldOperators(o,a)):L(r,this.parseField(o,this.u.defaultOperatorName,a,e))}return this.u.mergeFinalConditions(r)}};function q(t,e){let r=t[e];if(typeof r!="function")throw new Error(`Unable to interpret "${e}" condition. Did you forget to register interpreter for it?`);return r}function rt(t){return t.operator}function _e(t,e){let r=e,s=r&&r.getInterpreterName||rt,n;switch(r?r.numberOfArguments:0){case 1:n=o=>{let a=s(o,r);return q(t,a)(o,i)};break;case 3:n=(o,a,c)=>{let l=s(o,r);return q(t,l)(o,a,c,i)};break;default:n=(o,a)=>{let c=s(o,r);return q(t,c)(o,a,i)}}let i=Object.assign({},r,{interpret:n});return i.interpret}function Ee(t,e){return(r,...s)=>{let n=t(r,...s),i=e.bind(null,n);return i.ast=n,i}}var Pt=b.prototype.parseInstruction;function Fe(t,e){if(!Array.isArray(e))throw new Error(`"${t.name}" expects value to be an array`)}function ke(t,e){if(Fe(t,e),!e.length)throw new Error(`"${t.name}" expects to have at least one element in array`)}var B=t=>(e,r)=>{if(typeof r!==t)throw new Error(`"${e.name}" expects value to be a "${t}"`)},Ce={type:"compound",validate:ke,parse(t,e,{parse:r}){let s=e.map(n=>r(n));return J(t.name,s)}},st=Ce,nt={type:"compound",validate:ke},it={type:"field",validate(t,e){if(!(e&&(e instanceof RegExp||e.constructor===Object)))throw new Error(`"${t.name}" expects to receive either regular expression or object of field operators`)},parse(t,e,r){let s=e instanceof RegExp?new f("regex",r.field,e):r.parse(e,r);return new d(t.name,[s])}},H={type:"field",validate(t,e){if(!e||e.constructor!==Object)throw new Error(`"${t.name}" expects to receive an object with nested query or field level operators`)},parse(t,e,{parse:r,field:s,hasOperators:n}){let i=n(e)?r(e,{field:p}):r(e);return new f(t.name,s,i)}},Y={type:"field",validate:B("number")},v={type:"field",validate:Fe},G=v,W=v,ot={type:"field",validate(t,e){if(!Array.isArray(e)||e.length!==2)throw new Error(`"${t.name}" expects an array with 2 numeric elements`)}},X={type:"field",validate:B("boolean")},S={type:"field",validate:function(t,e){if(!(typeof e=="string"||typeof e=="number"||e instanceof Date))throw new Error(`"${t.name}" expects value to be comparable (i.e., string, number or date)`)}},w=S,K=w,Z=w,M={type:"field"},ee=M,te={type:"field",validate(t,e){if(!(e instanceof RegExp)&&typeof e!="string")throw new Error(`"${t.name}" expects value to be a regular expression or a string that represents regular expression`)},parse(t,e,r){let s=typeof e=="string"?new RegExp(e,r.query.$options||""):e;return new f(t.name,r.field,s)}},re={type:"field",parse:()=>Q},at={type:"document",validate:B("function")},ct=Object.freeze({__proto__:null,$and:Ce,$or:st,$nor:nt,$not:it,$elemMatch:H,$size:Y,$in:v,$nin:G,$all:W,$mod:ot,$exists:X,$gte:S,$gt:w,$lt:K,$lte:Z,$eq:M,$ne:ee,$regex:te,$options:re,$where:at}),T=class extends b{constructor(e){super(e,{defaultOperatorName:"$eq",operatorToConditionName:r=>r.slice(1)})}parse(e,r){return r&&r.field?V(this.parseFieldOperators(r.field,e)):super.parse(e)}},I=ct;function se(t,e,r){for(let s=0,n=t.length;s<n;s++)if(r(t[s],e)===0)return!0;return!1}function ne(t,e){return Array.isArray(t)&&Number.isNaN(Number(e))}function Re(t,e,r){if(!ne(t,e))return r(t,e);let s=[];for(let n=0;n<t.length;n++){let i=r(t[n],e);i!==void 0&&(s=s.concat(i))}return s}function m(t){return(e,r,s)=>{let n=s.get(r,e.field);return Array.isArray(n)?n.some(i=>t(e,i,s)):t(e,n,s)}}var lt=(t,e)=>t[e];function Pe(t,e,r){let s=e.lastIndexOf(".");return s===-1?[t,e]:[r(t,e.slice(0,s)),e.slice(s+1)]}function ut(t,e,r=lt){if(e===p)return t;if(!t)throw new Error(`Unable to get field "${e}" out of ${String(t)}.`);return function(s,n,i){if(n.indexOf(".")===-1)return Re(s,n,i);let o=n.split("."),a=s;for(let c=0,l=o.length;c<l;c++)if(a=Re(a,o[c],i),!a||typeof a!="object")return a;return a}(t,e,r)}function ie(t,e){return t===e?0:t>e?1:-1}function oe(t,e={}){return _e(t,Object.assign({get:ut,compare:ie},e))}var Ne=(t,e,{interpret:r})=>t.value.some(s=>r(s,e)),pt=(t,e,r)=>!Ne(t,e,r),ae=(t,e,{interpret:r})=>t.value.every(s=>r(s,e)),ht=(t,e,{interpret:r})=>!r(t.value[0],e),_=(t,e,{compare:r,get:s})=>{let n=s(e,t.field);return Array.isArray(n)&&!Array.isArray(t.value)?se(n,t.value,r):r(n,t.value)===0},ce=(t,e,r)=>!_(t,e,r),le=m((t,e,r)=>{let s=r.compare(e,t.value);return s===0||s===-1}),ue=m((t,e,r)=>r.compare(e,t.value)===-1),pe=m((t,e,r)=>r.compare(e,t.value)===1),he=m((t,e,r)=>{let s=r.compare(e,t.value);return s===0||s===1}),de=(t,e,{get:r})=>{if(t.field===p)return e!==void 0;let[s,n]=Pe(e,t.field,r),i=o=>o==null?!!o===t.value:o.hasOwnProperty(n)===t.value;return ne(s,n)?s.some(i):i(s)},dt=m((t,e)=>typeof e=="number"&&e%t.value[0]===t.value[1]),fe=(t,e,{get:r})=>{let[s,n]=Pe(e,t.field,r),i=o=>{let a=r(o,n);return Array.isArray(a)&&a.length===t.value};return t.field!==p&&ne(s,n)?s.some(i):i(s)},me=m((t,e)=>typeof e=="string"&&t.value.test(e)),$=m((t,e,{compare:r})=>se(t.value,e,r)),ge=(t,e,r)=>!$(t,e,r),ye=(t,e,{compare:r,get:s})=>{let n=s(e,t.field);return Array.isArray(n)&&t.value.every(i=>se(n,i,r))},be=(t,e,{interpret:r,get:s})=>{let n=s(e,t.field);return Array.isArray(n)&&n.some(i=>r(t.value,i))},ft=(t,e)=>t.value.call(e),mt=Object.freeze({__proto__:null,or:Ne,nor:pt,and:ae,not:ht,eq:_,ne:ce,lte:le,lt:ue,gt:pe,gte:he,exists:de,mod:dt,size:fe,regex:me,within:$,nin:ge,all:ye,elemMatch:be,where:ft}),E=Object.assign({},mt,{in:$}),zt=oe(E);function Ue(t){return t===null||typeof t!="object"?t:t instanceof Date?t.getTime():t&&typeof t.toJSON=="function"?t.toJSON():t}var gt=(t,e)=>ie(Ue(t),Ue(e));function F(t,e,r){let s=new T(t),n=oe(e,Object.assign({compare:gt},r));if(r&&r.forPrimitives){let i={field:p},o=s.parse;s.setParse(a=>o(a,i))}return Ee(s.parse,n)}var Ht=F(I,E),Yt=F(["$and","$or"].reduce((t,e)=>(t[e]=Object.assign({},t[e],{type:"field"}),t),Object.assign({},I,{$nor:Object.assign({},I.$nor,{type:"field",parse:A.compound})})),E,{forPrimitives:!0});function ve(t){return Array.isArray(t)?t:[t]}var De="__caslSubjectType__";var C=t=>{let e=typeof t;return e==="string"||e==="function"},yt=t=>t.modelName||t.name;function Ve(t){return Object.hasOwn(t,De)?t[De]:yt(t.constructor)}var Le={function:t=>t.constructor,string:Ve};function qe(t,e,r){for(let s=r;s<e.length;s++)t.push(e[s])}function ze(t,e){if(!t||!t.length)return e||[];if(!e||!e.length)return t||[];let r=0,s=0,n=[];for(;r<t.length&&s<e.length;)t[r].priority<e[s].priority?(n.push(t[r]),r++):(n.push(e[s]),s++);return qe(n,t,r),qe(n,e,s),n}function k(t,e,r){let s=t.get(e);return s||(s=r(),t.set(e,s)),s}var bt=t=>t;function vt(t,e){if(Array.isArray(t.fields)&&!t.fields.length)throw new Error("`rawRule.fields` cannot be an empty array. https://bit.ly/390miLa");if(t.fields&&!e.fieldMatcher)throw new Error('You need to pass "fieldMatcher" option in order to restrict access by fields');if(t.conditions&&!e.conditionsMatcher)throw new Error('You need to pass "conditionsMatcher" option in order to restrict access by conditions')}var we=class{constructor(e,r,s=0){vt(e,r),this.action=r.resolveAction(e.action),this.subject=e.subject,this.inverted=!!e.inverted,this.conditions=e.conditions,this.reason=e.reason,this.origin=e,this.fields=e.fields?ve(e.fields):void 0,this.priority=s,this.t=r}i(){return this.conditions&&!this.o&&(this.o=this.t.conditionsMatcher(this.conditions)),this.o}get ast(){let e=this.i();return e?e.ast:void 0}matchesConditions(e){return this.conditions?!e||C(e)?!this.inverted:this.i()(e):!0}matchesField(e){return this.fields?e?(this.u||(this.u=this.t.fieldMatcher(this.fields)),this.u(e)):!this.inverted:!0}};function wt(t,e){let r={value:t,prev:e,next:null};return e&&(e.next=r),r}function $t(t){t.next&&(t.next.prev=t.prev),t.prev&&(t.prev.next=t.next),t.next=t.prev=null}var jt=t=>({value:t.value,prev:t.prev,next:t.next}),Qe=()=>({rules:[],merged:!1}),Je=()=>new Map,$e=class{constructor(e=[],r={}){this.h=!1,this.l=new Map,this.p={conditionsMatcher:r.conditionsMatcher,fieldMatcher:r.fieldMatcher,resolveAction:r.resolveAction||bt},this.$=r.anyAction||"manage",this.A=r.anySubjectType||"all",this.m=e,this.M=!!r.detectSubjectType,this.j=r.detectSubjectType||Ve,this.v(e)}get rules(){return this.m}detectSubjectType(e){return C(e)?e:e?this.j(e):this.A}update(e){let r={rules:e,ability:this,target:this};return this._("update",r),this.m=e,this.v(e),this._("updated",r),this}v(e){let r=new Map,s;for(let n=e.length-1;n>=0;n--){let i=e.length-n-1,o=new we(e[n],this.p,i),a=ve(o.action),c=ve(o.subject||this.A);!this.h&&o.fields&&(this.h=!0);for(let l=0;l<c.length;l++){let Xe=k(r,c[l],Je);s===void 0&&(s=typeof c[l]),typeof c[l]!==s&&s!=="mixed"&&(s="mixed");for(let D=0;D<a.length;D++)k(Xe,a[D],Qe).rules.push(o)}}if(this.l=r,s!=="mixed"&&!this.M){let n=Le[s]||Le.string;this.j=n}}possibleRulesFor(e,r=this.A){if(!C(r))throw new Error('"possibleRulesFor" accepts only subject types (i.e., string or class) as the 2nd parameter');let s=k(this.l,r,Je),n=k(s,e,Qe);if(n.merged)return n.rules;let i=e!==this.$&&s.has(this.$)?s.get(this.$).rules:void 0,o=ze(n.rules,i);return r!==this.A&&(o=ze(o,this.possibleRulesFor(e,this.A))),n.rules=o,n.merged=!0,o}rulesFor(e,r,s){let n=this.possibleRulesFor(e,r);if(s&&typeof s!="string")throw new Error("The 3rd, `field` parameter is expected to be a string. See https://stalniy.github.io/casl/en/api/casl-ability#can-of-pure-ability for details");return this.h?n.filter(i=>i.matchesField(s)):n}actionsFor(e){if(!C(e))throw new Error('"actionsFor" accepts only subject types (i.e., string or class) as a parameter');let r=new Set,s=this.l.get(e);s&&Array.from(s.keys()).forEach(i=>r.add(i));let n=e!==this.A?this.l.get(this.A):void 0;return n&&Array.from(n.keys()).forEach(i=>r.add(i)),Array.from(r)}on(e,r){this.F=this.F||new Map;let s=this.F,n=s.get(e)||null,i=wt(r,n);return s.set(e,i),()=>{let o=s.get(e);!i.next&&!i.prev&&o===i?s.delete(e):i===o&&s.set(e,i.prev),$t(i)}}_(e,r){if(!this.F)return;let s=this.F.get(e)||null;for(;s!==null;){let n=s.prev?jt(s.prev):null;s.value(r),s=n}}},g=class extends $e{can(e,r,s){let n=this.relevantRuleFor(e,r,s);return!!n&&!n.inverted}relevantRuleFor(e,r,s){let n=this.detectSubjectType(r),i=this.rulesFor(e,n,s);for(let o=0,a=i.length;o<a;o++)if(i[o].matchesConditions(r))return i[o];return null}cannot(e,r,s){return!this.can(e,r,s)}},xt={$eq:M,$ne:ee,$lt:K,$lte:Z,$gt:w,$gte:S,$in:v,$nin:G,$all:W,$size:Y,$regex:te,$options:re,$elemMatch:H,$exists:X},Ot={eq:_,ne:ce,lt:ue,lte:le,gt:pe,gte:he,in:$,nin:ge,all:ye,size:fe,regex:me,elemMatch:be,exists:de,and:ae};var Be=F(xt,Ot),At=/[-/\\^$+?.()|[\]{}]/g,Tt=/\.?\*+\.?/g,St=/\*+/,Mt=/\./g;function It(t,e,r){let s=r[0]==="*"||t[0]==="."&&t[t.length-1]==="."?"+":"*",n=t.indexOf("**")===-1?"[^.]":".",i=t.replace(Mt,"\\$&").replace(St,n+s);return e+t.length===r.length?`(?:${i})?`:i}function _t(t,e,r){return t==="."&&(r[e-1]==="*"||r[e+1]==="*")?t:`\\${t}`}function Et(t){let e=t.map(s=>s.replace(At,_t).replace(Tt,It)),r=e.length>1?`(?:${e.join("|")})`:e[0];return new RegExp(`^${r}$`)}var He=t=>{let e;return r=>(typeof e>"u"&&(e=t.every(s=>s.indexOf("*")===-1)?null:Et(t)),e===null?t.indexOf(r)!==-1:e.test(r))},R=class extends g{constructor(e=[],r={}){super(e,Object.assign({conditionsMatcher:Be,fieldMatcher:He},r))}};function Ye(t=[],e={}){return new g(t,Object.assign({conditionsMatcher:Be,fieldMatcher:He},e))}function Ft(t){return t.prototype!==void 0&&typeof t.prototype.possibleRulesFor=="function"}var je=class{constructor(e){this.O=e}because(e){return this.O.reason=e,this}},P=class{constructor(e){this.rules=[],this.C=e,this.can=(r,s,n,i)=>this.R(r,s,n,i,!1),this.cannot=(r,s,n,i)=>this.R(r,s,n,i,!0),this.build=r=>Ft(this.C)?new this.C(this.rules,r):this.C(this.rules,r)}R(e,r,s,n,i){let o={action:e};return i&&(o.inverted=i),r&&(o.subject=r,Array.isArray(s)||typeof s=="string"?o.fields=s:typeof s<"u"&&(o.conditions=s),typeof n<"u"&&(o.conditions=n)),this.rules.push(o),new je(o)}};var kt=function(e){this.message=e};kt.prototype=Object.create(Error.prototype);var er=Object.freeze({__proto__:null});var N={production:!1,appName:"clara Admin",API_URL:"http://localhost:3000/api/v1",default_currency_code:"id",SECRET_KEY:"f700b144d921cf98f8c9b8f13c89b69b72954a8d259ad3a181e79689c7156353"};var Ge=N.API_URL,U=class t{constructor(e,r,s,n){this.http=e;this.router=r;this.ability=s;this.platformId=n;if(x(this.platformId)){let i=this.getTokenFromStorage();this.currentUserTokenSignal.set(i),this.isReadySignal.set(!0)}}currentUserTokenSignal=u("");currentUserDataSignal=u(null);isReadySignal=u(!1);init(){this.currentUserTokenSignal()&&this.loadUserData()}getTokenFromStorage(){return JSON.parse(localStorage.getItem("access_token")||'""')}updateAbility(e){let{can:r,rules:s}=new P(Ye);console.log(e),e?.division_id===1?(r("manage","User"),r("manage","Division"),r("manage","Attendance")):e?.division_id===2?r("manage","Task"):e?.division_id===3||e?.division_id===4?(r("create","Task"),r("read","Task")):r("read","PublicData"),this.ability.update(s),console.log(s)}get userToken(){return this.currentUserTokenSignal}get userData(){return this.currentUserDataSignal}get isReady(){return this.isReadySignal}isLoggedIn(){return x(this.platformId)&&!!this.userToken()}fetchUser(){return this.http.get(Ge+"/auth/profile")}loadUserData(){this.fetchUser().subscribe({next:e=>{let r=e.data;this.currentUserDataSignal.set(r),this.userData.set(r),this.updateAbility(r)}})}setToken(e){localStorage.setItem("access_token",JSON.stringify(e)),this.currentUserTokenSignal.set(e)}login(e){return this.http.post(Ge+"/auth/login",e).pipe(xe(r=>(console.log(r),r.data.access_token?(this.setToken(r.data.access_token),this.loadUserData(),this.updateAbility(r.data.user),!0):!1)))}logout(){x(this.platformId)&&(localStorage.removeItem("access_token"),localStorage.removeItem("user"),this.userToken.set("")),this.router.navigate(["/auth/login"])}static \u0275fac=function(r){return new(r||t)(h(Te),h(Se),h(g),h(Ae))};static \u0275prov=j({token:t,factory:t.\u0275fac,providedIn:"root"})};var $r=N.API_URL,We=class t{constructor(e){this.ability=e;this.sidebarMenus=[{name:"dashboard",icon:"dashboard",path:"/dashboard",subject:""},{name:"user",icon:"users",path:"/users",subject:"User"},{name:"division",icon:"division",path:"/divisions",subject:"Division"},{name:"attendance",icon:"attendance",path:"/attendances",subject:"Attendance"},{name:"assignment",icon:"clipboard",path:"/assignments",subject:"Task"}]}authService=Oe(U);isNotificationVisible=u(!1);currentPageName=u("");isUserVisible=u(!1);isShowSidebar=u(window.innerWidth>=569);currentTheme=u("light");sidebarMenus=[];get visibleSidebarMenus(){return this.sidebarMenus.filter(e=>e.subject?this.ability.can("read",e.subject):!0)}toggleSidebar(){this.isShowSidebar.set(!this.isShowSidebar())}initializeTheme(){if(typeof window<"u"){let e=localStorage.getItem("theme-preference");e&&["light","dark","system"].includes(e)&&this.currentTheme.set(e),this.applyTheme()}}setupSystemThemeListener(){typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{this.currentTheme()==="system"&&this.applyTheme()})}getSystemTheme(){return typeof window<"u"&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"}setTheme(e){this.currentTheme.set(e),typeof window<"u"&&localStorage.setItem("theme-preference",e),this.applyTheme()}applyTheme(){if(typeof document>"u")return;let e=document.documentElement,r=this.currentTheme();if(e.classList.remove("light","dark"),r==="system"){let s=this.getSystemTheme();e.classList.add(s)}else e.classList.add(r)}static \u0275fac=function(r){return new(r||t)(h(R))};static \u0275prov=j({token:t,factory:t.\u0275fac,providedIn:"root"})};export{g as a,R as b,Ye as c,N as d,U as e,We as f};
